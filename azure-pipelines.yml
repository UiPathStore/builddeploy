trigger:
- main

pool:
  uipath

steps:
- script: echo Hello, world!
  displayName: 'Run a one-line script'

- script: |
    echo Add other tasks to build, test, and deploy your project.
    echo See https://aka.ms/yaml
  displayName: 'Run a multi-line script'

# Fetch the latest code from the Git repository
- checkout: self

# Loop through each directory containing test cases
- script: |
    for dir in $(ls -d */); do
      cd $dir
      if [ -f "project.json" ]; then
        echo "Building $dir..."
        uipath pack --projectJsonPath "project.json" --outputPath $(Build.ArtifactStagingDirectory)/$dir
      else
        echo "No project.json found in $dir. Skipping build."
      fi
      cd ..
    done
  displayName: 'Build and pack test cases'

# Deploy the test cases to UiPath Orchestrator
- script: |
    for package in $(find $(Build.ArtifactStagingDirectory) -name "*.nupkg"); do
      echo "Deploying $package..."
      uipath deploy --packagesPath $package --orchestratorConnection 'Uipath' --folderName 'VariantMatrix' # Update folderName as needed
    done
  displayName: 'Deploy test cases to UiPath Orchestrator'
